{"version":3,"sources":["deparam.ts","repo-regex.ts","page-attributes.ts","utterances-api.ts","oauth.ts","encoding.ts","github.ts","time-ago.ts","measure.ts","comment-component.ts","timeline-component.ts","new-comment-component.ts","theme.ts","utterances.ts"],"names":[],"mappings":"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","file":"utterances.74a2fd99.map","sourceRoot":"../src","sourcesContent":["export function deparam(query: string): { [name: string]: string; } {\n  let match: RegExpExecArray | null;\n  const plus = /\\+/g;\n  const search = /([^&=]+)=?([^&]*)/g;\n  const decode = (s: string) => decodeURIComponent(s.replace(plus, ' '));\n  const params: { [name: string]: string; } = {};\n  // tslint:disable-next-line:no-conditional-assignment\n  while (match = search.exec(query)) {\n    params[decode(match[1])] = decode(match[2]);\n  }\n  return params;\n}\n\nexport function param(obj: any) {\n  const parts = [];\n  for (const name in obj) {\n    if (obj.hasOwnProperty(name)) {\n      parts.push(`${encodeURIComponent(name)}=${encodeURIComponent(obj[name])}`);\n    }\n  }\n  return parts.join('&');\n}\n","export default /^([\\w-_]+)\\/([\\w-_.]+)$/i;\n","import { deparam } from './deparam';\nimport repoRegex from './repo-regex';\n\nfunction readPageAttributes() {\n  const params = deparam(location.search.substr(1));\n\n  let issueTerm: string | null = null;\n  let issueNumber: number | null = null;\n  if ('issue-term' in params) {\n    issueTerm = params['issue-term'];\n    if (issueTerm !== undefined) {\n      if (issueTerm === '') {\n        throw new Error('When issue-term is specified, it cannot be blank.');\n      }\n      if (['title', 'url', 'pathname', 'og:title'].indexOf(issueTerm) !== -1) {\n        if (!params[issueTerm]) {\n          throw new Error(`Unable to find \"${issueTerm}\" metadata.`);\n        }\n        issueTerm = params[issueTerm];\n      }\n    }\n  } else if ('issue-number' in params) {\n    issueNumber = +params['issue-number'];\n    if (issueNumber.toString(10) !== params['issue-number']) {\n      throw new Error(`issue-number is invalid. \"${params['issue-number']}`);\n    }\n  } else {\n    throw new Error('\"issue-term\" or \"issue-number\" must be specified.');\n  }\n\n  if (!('repo' in params)) {\n    throw new Error('\"repo\" is required.');\n  }\n\n  if (!('origin' in params)) {\n    throw new Error('\"origin\" is required.');\n  }\n\n  const matches = repoRegex.exec(params.repo);\n  if (matches === null) {\n    throw new Error(`Invalid repo: \"${params.repo}\"`);\n  }\n\n  return {\n    owner: matches[1],\n    repo: matches[2],\n    issueTerm,\n    issueNumber,\n    origin: params.origin,\n    url: params.url,\n    title: params.title,\n    description: params.description,\n    theme: params.theme || 'github-light'\n  };\n}\n\nexport const pageAttributes = readPageAttributes();\n","// export const UTTERANCES_API = 'http://localhost:5000';\nexport const UTTERANCES_API = 'https://api.utteranc.es';\n","import { UTTERANCES_API } from './utterances-api';\nimport { param } from './deparam';\n\nconst authorizeUrl = `${UTTERANCES_API}/authorize`;\nconst tokenUrl = `${UTTERANCES_API}/token`;\n// tslint:disable-next-line:variable-name\nconst redirect_uri = `${location.origin}/authorized.html`;\n\nclass Token {\n  private readonly storageKey = 'OAUTH_TOKEN2';\n  private token: string | null = null;\n\n  constructor() {\n    try {\n      this.token = localStorage.getItem(this.storageKey);\n      // tslint:disable-next-line:no-empty\n    } catch (e) { }\n  }\n\n  get value() {\n    return this.token;\n  }\n  set value(newValue) {\n    this.token = newValue;\n    try {\n      if (newValue === null) {\n        localStorage.removeItem(this.storageKey);\n      } else {\n        localStorage.setItem(this.storageKey, newValue);\n      }\n      // tslint:disable-next-line:no-empty\n    } catch (e) { }\n  }\n}\n\nexport const token = new Token();\n\nexport function login() {\n  window.open(`${authorizeUrl}?${param({ redirect_uri })}`);\n  return new Promise(resolve => (window as any).notifyAuthorized = resolve)\n    .then(search => fetch(tokenUrl + search, { mode: 'cors' }))\n    .then(response => {\n      if (response.ok) {\n        return response.json();\n      }\n      return response.text().then(text => Promise.reject(`Error retrieving token:\\n${text}`));\n    })\n    .then(t => { token.value = t; }, reason => { token.value = null; throw reason; });\n}\n","declare function escape(str: string): string;\n\nexport function decodeBase64UTF8(encoded: string) {\n  encoded = encoded.replace(/\\s/g, '');\n  return decodeURIComponent(escape(atob(encoded)));\n}\n","import { token } from './oauth';\nimport { decodeBase64UTF8 } from './encoding';\nimport { UTTERANCES_API } from './utterances-api';\n\nconst GITHUB_API = 'https://api.github.com/';\nconst GITHUB_ENCODING__HTML_JSON = 'application/vnd.github.VERSION.html+json';\nconst GITHUB_ENCODING__HTML = 'application/vnd.github.VERSION.html';\nconst GITHUB_ENCODING__REACTIONS_PREVIEW = 'application/vnd.github.squirrel-girl-preview';\nconst PAGE_SIZE = 100;\n\nlet owner: string;\nlet repo: string;\nconst branch = 'master';\n\nexport function setRepoContext(context: { owner: string; repo: string; }) {\n  owner = context.owner;\n  repo = context.repo;\n}\n\nfunction githubRequest(relativeUrl: string, init?: RequestInit) {\n  init = init || {};\n  init.mode = 'cors';\n  init.cache = 'no-cache'; // force conditional request\n  const request = new Request(GITHUB_API + relativeUrl, init);\n  request.headers.set('Accept', GITHUB_ENCODING__REACTIONS_PREVIEW);\n  if (!/^search\\//.test(relativeUrl) && token.value !== null) {\n    request.headers.set('Authorization', `token ${token.value}`);\n  }\n  return request;\n}\n\nconst rateLimit = {\n  standard: {\n    limit: Number.MAX_VALUE,\n    remaining: Number.MAX_VALUE,\n    reset: 0\n  },\n  search: {\n    limit: Number.MAX_VALUE,\n    remaining: Number.MAX_VALUE,\n    reset: 0\n  }\n};\n\nfunction processRateLimit(response: Response) {\n  const limit = response.headers.get('X-RateLimit-Limit')!;\n  const remaining = response.headers.get('X-RateLimit-Remaining')!;\n  const reset = response.headers.get('X-RateLimit-Reset')!;\n\n  const isSearch = /\\/search\\//.test(response.url);\n  const rate = isSearch ? rateLimit.search : rateLimit.standard;\n\n  rate.limit = +limit;\n  rate.remaining = +remaining;\n  rate.reset = +reset;\n\n  if (response.status === 403 && rate.remaining === 0) {\n    const resetDate = new Date(0);\n    resetDate.setUTCSeconds(rate.reset);\n    const mins = Math.round((resetDate.getTime() - new Date().getTime()) / 1000 / 60);\n    const apiType = isSearch ? 'search API' : 'non-search APIs';\n    // tslint:disable-next-line:no-console\n    console.warn(`Rate limit exceeded for ${apiType}. Resets in ${mins} minute${mins === 1 ? '' : 's'}.`);\n  }\n}\n\nfunction readRelNext(response: Response) {\n  const link = response.headers.get('link');\n  if (link === null) {\n    return 0;\n  }\n  const match = /\\?page=([2-9][0-9]*)>; rel=\"next\"/.exec(link);\n  if (match === null) {\n    return 0;\n  }\n  return +match[1];\n}\n\nfunction githubFetch(request: Request): Promise<Response> {\n  return fetch(request).then(response => {\n    if (response.status === 401) {\n      token.value = null;\n    }\n    if (response.status === 403) {\n      response.json().then(data => {\n        if (data.message === 'Resource not accessible by integration') {\n          window.dispatchEvent(new CustomEvent('not-installed'));\n        }\n      });\n    }\n\n    processRateLimit(response);\n\n    if (request.method === 'GET'\n      && [401, 403].indexOf(response.status) !== -1\n      && request.headers.has('Authorization')\n    ) {\n      request.headers.delete('Authorization');\n      return githubFetch(request);\n    }\n    return response;\n  });\n}\n\nexport function loadJsonFile<T>(path: string, html = false) {\n  const request = githubRequest(`repos/${owner}/${repo}/contents/${path}?ref=${branch}`);\n  if (html) {\n    request.headers.set('accept', GITHUB_ENCODING__HTML);\n  }\n  return githubFetch(request).then<FileContentsResponse | string>(response => {\n    if (response.status === 404) {\n      throw new Error(`Repo \"${owner}/${repo}\" does not have a file named \"${path}\" in the \"${branch}\" branch.`);\n    }\n    if (!response.ok) {\n      throw new Error(`Error fetching ${path}.`);\n    }\n    return html ? response.text() : response.json();\n  }).then<T>(file => {\n    if (html) {\n      return file;\n    }\n    const { content } = file as FileContentsResponse;\n    const decoded = decodeBase64UTF8(content);\n    return JSON.parse(decoded);\n  });\n}\n\nexport function loadIssueByTerm(term: string) {\n  const q = `\"${term}\" type:issue in:title repo:${owner}/${repo}`;\n  const request = githubRequest(`search/issues?q=${encodeURIComponent(q)}&sort=created&order=asc`);\n  return githubFetch(request).then<IssueSearchResponse>(response => {\n    if (!response.ok) {\n      throw new Error('Error fetching issue via search.');\n    }\n    return response.json();\n  }).then(results => {\n    if (results.total_count === 0) {\n      return null;\n    }\n    if (results.total_count > 1) {\n      // tslint:disable-next-line:no-console\n      console.warn(`Multiple issues match \"${q}\". Using earliest created.`);\n    }\n    return results.items[0];\n  });\n}\n\nexport function loadIssueByNumber(issueNumber: number) {\n  const request = githubRequest(`repos/${owner}/${repo}/issues/${issueNumber}`);\n  return githubFetch(request).then<Issue>(response => {\n    if (!response.ok) {\n      throw new Error('Error fetching issue via issue number.');\n    }\n    return response.json();\n  });\n}\n\nfunction commentsRequest(issueNumber: number, page: number) {\n  const url = `repos/${owner}/${repo}/issues/${issueNumber}/comments?page=${page}&per_page=${PAGE_SIZE}`;\n  const request = githubRequest(url);\n  const accept = `${GITHUB_ENCODING__HTML_JSON},${GITHUB_ENCODING__REACTIONS_PREVIEW}`;\n  request.headers.set('Accept', accept);\n  return request;\n}\n\nexport function loadCommentsPage(issueNumber: number, page: number) {\n  const request = commentsRequest(issueNumber, page);\n  return githubFetch(request).then(response => {\n    if (!response.ok) {\n      throw new Error('Error fetching comments.');\n    }\n    const nextPage = readRelNext(response);\n    return response.json()\n      .then<CommentsPage>((items: IssueComment[]) => ({ items, nextPage }));\n  });\n}\n\nexport function loadUser(): Promise<User | null> {\n  if (token.value === null) {\n    return Promise.resolve(null);\n  }\n  return githubFetch(githubRequest('user'))\n    .then(response => {\n      if (response.ok) {\n        return response.json();\n      }\n      return null;\n    });\n}\n\nexport function createIssue(issueTerm: string, documentUrl: string, title: string, description: string) {\n  const request = new Request(`${UTTERANCES_API}/repos/${owner}/${repo}/issues`, {\n    method: 'POST',\n    body: JSON.stringify({\n      title: issueTerm,\n      body: `# ${title}\\n\\n${description}\\n\\n[${documentUrl}](${documentUrl})`\n    })\n  });\n  request.headers.set('Accept', GITHUB_ENCODING__REACTIONS_PREVIEW);\n  request.headers.set('Authorization', `token ${token.value}`);\n  return fetch(request).then<Issue>(response => {\n    if (!response.ok) {\n      throw new Error('Error creating comments container issue');\n    }\n    return response.json();\n  });\n}\n\nexport function postComment(issueNumber: number, markdown: string) {\n  const url = `repos/${owner}/${repo}/issues/${issueNumber}/comments`;\n  const body = JSON.stringify({ body: markdown });\n  const request = githubRequest(url, { method: 'POST', body });\n  const accept = `${GITHUB_ENCODING__HTML_JSON},${GITHUB_ENCODING__REACTIONS_PREVIEW}`;\n  request.headers.set('Accept', accept);\n  return githubFetch(request).then<IssueComment>(response => {\n    if (!response.ok) {\n      throw new Error('Error posting comment.');\n    }\n    return response.json();\n  });\n}\n\nexport function renderMarkdown(text: string) {\n  const body = JSON.stringify({ text, mode: 'gfm', context: `${owner}/${repo}` });\n  return githubFetch(githubRequest('markdown', { method: 'POST', body }))\n    .then(response => response.text());\n}\n\ninterface IssueSearchResponse {\n  total_count: number;\n  incomplete_results: boolean;\n  items: Issue[];\n}\n\nexport interface User {\n  login: string;\n  id: number;\n  avatar_url: string;\n  gravatar_id: string;\n  url: string;\n  html_url: string;\n  followers_url: string;\n  following_url: string;\n  gists_url: string;\n  starred_url: string;\n  subscriptions_url: string;\n  organizations_url: string;\n  repos_url: string;\n  events_url: string;\n  received_events_url: string;\n  type: string;\n}\n\nexport type CommentAuthorAssociation =\n  'COLLABORATOR'\n  | 'CONTRIBUTOR'\n  | 'FIRST_TIMER'\n  | 'FIRST_TIME_CONTRIBUTOR'\n  | 'MEMBER'\n  | 'NONE'\n  | 'OWNER';\n\nexport interface Issue {\n  url: string;\n  repository_url: string;\n  labels_url: string;\n  comments_url: string;\n  events_url: string;\n  html_url: string;\n  id: number;\n  number: number;\n  title: string;\n  user: User;\n  locked: boolean;\n  labels: {\n    url: string;\n    name: string;\n    color: string;\n  }[];\n  state: string;\n  assignee: null; // todo,\n  milestone: null; // todo,\n  comments: number;\n  created_at: string;\n  updated_at: string;\n  closed_at: null; // todo,\n  pull_request: {\n    html_url: null; // todo,\n    diff_url: null; // todo,\n    patch_url: null; // todo\n  };\n  body: string;\n  score: number;\n  reactions: {\n    total_count: number;\n    '+1': number;\n    '-1': number;\n    laugh: number;\n    confused: number;\n    heart: number;\n    hooray: number;\n    url: string;\n  };\n  author_association: CommentAuthorAssociation;\n}\n\ninterface FileContentsResponse {\n  type: string;\n  encoding: string;\n  size: number;\n  name: string;\n  path: string;\n  content: string;\n  sha: string;\n  url: string;\n  git_url: string;\n  html_url: string;\n  download_url: string;\n}\n\nexport interface IssueComment {\n  id: number;\n  url: string;\n  html_url: string;\n  body_html: string;\n  user: User;\n  created_at: string;\n  updated_at: string;\n  author_association: CommentAuthorAssociation;\n}\n\nexport interface CommentsPage {\n  items: IssueComment[];\n  nextPage: number;\n}\n\n/*\nquery IssueComments($owner: String!, $repo: String!, $issueQuery: String!) {\n  search(query: $issueQuery, type: ISSUE, first: 1) {\n    issueCount\n    edges {\n      node {\n        ... on Issue {\n          id\n          title,\n          comments(first: 100) {\n          \ttotalCount\n            edges {\n              node {\n                id,\n                createdAt,\n                bodyHTML,\n                author {\n                  avatarUrl,\n                  login\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  rateLimit {\n    cost\n    limit\n    remaining\n    resetAt\n  }\n\n  repository(owner: $owner, name: $repo) {\n    object(expression: \"master:utterances.json\") {\n      ... on Blob {\n        text\n      }\n    }\n  }\n}\n\n{\n  \"issueQuery\": \"user:jdanyow repo:utterances-demo debug\",\n  \"owner\": \"jdanyow\",\n  \"repo\": \"utterances-demo\"\n}\n*/\n","// todo: take a dependency on some relative time library.\n\nconst thresholds = [\n  1000, 'second',\n  1000 * 60, 'minute',\n  1000 * 60 * 60, 'hour',\n  1000 * 60 * 60 * 24, 'day',\n  1000 * 60 * 60 * 24 * 7, 'week',\n  1000 * 60 * 60 * 24 * 27, 'month'\n];\n\nconst formatOptions: Intl.DateTimeFormatOptions = { month: 'short', day: 'numeric', year: 'numeric' };\n\nexport function timeAgo(current: number, value: Date) {\n  const elapsed = current - value.getTime();\n  if (elapsed < 5000) {\n    return 'just now';\n  }\n  let i = 0;\n  while (i + 2 < thresholds.length && elapsed * 1.1 > thresholds[i + 2]) {\n    i += 2;\n  }\n\n  const divisor = thresholds[i] as number;\n  const text = thresholds[i + 1] as string;\n  const units = Math.round(elapsed / divisor);\n\n  if (units > 3 && i === thresholds.length - 2) {\n    return `on ${value.toLocaleDateString(undefined, formatOptions)}`;\n  }\n  return units === 1 ? `${text === 'hour' ? 'an' : 'a'} ${text} ago` : `${units} ${text}s ago`;\n}\n","export interface ResizeMessage {\n  type: 'resize';\n  height: number;\n}\n\nlet hostOrigin: string;\n\nexport function startMeasuring(origin: string) {\n  hostOrigin = origin;\n  addEventListener('resize', scheduleMeasure);\n  addEventListener('load', scheduleMeasure);\n}\n\nlet lastHeight = -1;\n\nfunction measure() {\n  const height = document.body.scrollHeight;\n  if (height === lastHeight) {\n    return;\n  }\n  lastHeight = height;\n  const message: ResizeMessage = { type: 'resize', height };\n  parent.postMessage(message, hostOrigin);\n}\n\nlet lastMeasure = 0;\n\nexport function scheduleMeasure() {\n  const now = Date.now();\n  if (now - lastMeasure > 50) {\n    lastMeasure = now;\n    setTimeout(measure, 50);\n  }\n}\n","import { IssueComment } from './github';\nimport { timeAgo } from './time-ago';\nimport { scheduleMeasure } from './measure';\n\nconst avatarArgs = '?v=3&s=88';\nconst displayAssociations: { [association: string]: string; } = {\n  COLLABORATOR: 'Collaborator',\n  CONTRIBUTOR: 'Contributor',\n  MEMBER: 'Member',\n  OWNER: 'Owner'\n};\n\nexport class CommentComponent {\n  public readonly element: HTMLElement;\n\n  constructor(\n    public comment: IssueComment,\n    private currentUser: string | null\n  ) {\n    const { user, html_url, created_at, body_html, author_association } = comment;\n    this.element = document.createElement('article');\n    this.element.classList.add('timeline-comment');\n    if (user.login === currentUser) {\n      this.element.classList.add('current-user');\n    }\n    const association = displayAssociations[author_association];\n    this.element.innerHTML = `\n      <a class=\"avatar\" href=\"${user.html_url}\" target=\"_blank\" tabindex=\"-1\">\n        <img alt=\"@${user.login}\" height=\"44\" width=\"44\"\n              src=\"${user.avatar_url}${avatarArgs}\">\n      </a>\n      <div class=\"comment\">\n        <header class=\"comment-header\">\n          <span class=\"comment-meta\">\n            <a class=\"text-link\" href=\"${user.html_url}\" target=\"_blank\"><strong>${user.login}</strong></a>\n            commented\n            <a class=\"text-link\" href=\"${html_url}\" target=\"_blank\">${timeAgo(Date.now(), new Date(created_at))}</a>\n          </span>\n          ${association ? `<span class=\"author-association-badge\">${association}</span>` : ''}\n        </header>\n        <div class=\"markdown-body markdown-body-scrollable\">\n          ${body_html}\n        </div>\n      </div>`;\n\n    const markdownBody = this.element.lastElementChild!.lastElementChild!;\n    const emailToggle = markdownBody.querySelector('.email-hidden-toggle a') as HTMLAnchorElement;\n    if (emailToggle) {\n      const emailReply = markdownBody.querySelector('.email-hidden-reply') as HTMLDivElement;\n      emailToggle.onclick = event => {\n        event.preventDefault();\n        emailReply.classList.toggle('expanded');\n      };\n    }\n\n    processRenderedMarkdown(markdownBody);\n  }\n\n  public setCurrentUser(currentUser: string | null) {\n    if (this.currentUser === currentUser) {\n      return;\n    }\n    this.currentUser = currentUser;\n\n    if (this.comment.user.login === this.currentUser) {\n      this.element.classList.add('current-user');\n    } else {\n      this.element.classList.remove('current-user');\n    }\n  }\n}\n\nexport function processRenderedMarkdown(markdownBody: Element) {\n  Array.from(markdownBody.querySelectorAll<HTMLAnchorElement>(':not(.email-hidden-toggle) > a'))\n    .forEach(a => { a.target = '_top'; a.rel = 'noopener noreferrer'; });\n  Array.from(markdownBody.querySelectorAll<HTMLImageElement>('img'))\n    .forEach(img => img.onload = scheduleMeasure);\n  Array.from(markdownBody.querySelectorAll<HTMLAnchorElement>('a.commit-tease-sha'))\n    .forEach(a => a.href = 'https://github.com' + a.pathname);\n}\n","import { User, Issue, IssueComment } from './github';\nimport { CommentComponent } from './comment-component';\nimport { scheduleMeasure } from './measure';\n\nexport class TimelineComponent {\n  public readonly element: HTMLElement;\n  private readonly timeline: CommentComponent[] = [];\n  private readonly countAnchor: HTMLAnchorElement;\n  private readonly marker: Node;\n  private count: number = 0;\n\n  constructor(\n    private user: User | null,\n    private issue: Issue | null\n  ) {\n    this.element = document.createElement('main');\n    this.element.classList.add('timeline');\n    this.element.innerHTML = `\n      <h1 class=\"timeline-header\">\n        <a class=\"text-link\" target=\"_blank\"></a>\n        <em>\n          - powered by\n          <a class=\"text-link\" href=\"https://utteranc.es\" target=\"_blank\">utteranc.es</a>\n        </em>\n      </h1>`;\n    this.countAnchor = this.element.firstElementChild!.firstElementChild as HTMLAnchorElement;\n    this.marker = document.createComment('marker');\n    this.element.appendChild(this.marker);\n    this.setIssue(this.issue);\n    this.renderCount();\n  }\n\n  public setUser(user: User | null) {\n    this.user = user;\n    const login = user ? user.login : null;\n    for (let i = 0; i < this.timeline.length; i++) {\n      this.timeline[i].setCurrentUser(login);\n    }\n    scheduleMeasure();\n  }\n\n  public setIssue(issue: Issue | null) {\n    this.issue = issue;\n    if (issue) {\n      this.countAnchor.href = issue.html_url;\n    } else {\n      this.countAnchor.removeAttribute('href');\n    }\n  }\n\n  public appendComment(comment: IssueComment) {\n    const component = new CommentComponent(\n      comment,\n      this.user ? this.user.login : null);\n    this.timeline.push(component);\n    this.element.insertBefore(component.element, this.marker);\n    this.count++;\n    this.renderCount();\n    scheduleMeasure();\n  }\n\n  private renderCount() {\n    this.countAnchor.textContent = `${this.count} Comment${this.count === 1 ? '' : 's'}`;\n  }\n}\n","import { User, renderMarkdown } from './github';\nimport { scheduleMeasure } from './measure';\nimport { processRenderedMarkdown } from './comment-component';\n\n// tslint:disable-next-line:max-line-length\nconst anonymousAvatar = `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14 16\" version=\"1.1\"><path fill=\"rgb(179,179,179)\" fill-rule=\"evenodd\" d=\"M8 10.5L9 14H5l1-3.5L5.25 9h3.5L8 10.5zM10 6H4L2 7h10l-2-1zM9 2L7 3 5 2 4 5h6L9 2zm4.03 7.75L10 9l1 2-2 3h3.22c.45 0 .86-.31.97-.75l.56-2.28c.14-.53-.19-1.08-.72-1.22zM4 9l-3.03.75c-.53.14-.86.69-.72 1.22l.56 2.28c.11.44.52.75.97.75H5l-2-3 1-2z\"></path></svg>`;\n// base64 encoding works in IE, Edge. UTF-8 does not.\nconst anonymousAvatarUrl = `data:image/svg+xml;base64,${btoa(anonymousAvatar)}`;\n\nconst nothingToPreview = 'Nothing to preview';\n\nexport class NewCommentComponent {\n  public readonly element: HTMLElement;\n\n  private avatarAnchor: HTMLAnchorElement;\n  private avatar: HTMLImageElement;\n  private form: HTMLFormElement;\n  private textarea: HTMLTextAreaElement;\n  private preview: HTMLDivElement;\n  private submitButton: HTMLButtonElement;\n\n  private submitting = false;\n  private renderTimeout = 0;\n\n  constructor(\n    private user: User | null,\n    private readonly submit: (markdown: string) => Promise<void>\n  ) {\n    this.element = document.createElement('article');\n    this.element.classList.add('timeline-comment');\n\n    this.element.innerHTML = `\n      <a class=\"avatar\" target=\"_blank\" tabindex=\"-1\">\n        <img height=\"44\" width=\"44\">\n      </a>\n      <form class=\"comment\" accept-charset=\"UTF-8\" action=\"javascript:\">\n        <header class=\"new-comment-header\">\n          <nav class=\"tabnav-tabs\" role=\"tablist\">\n            <button type=\"button\" class=\"tabnav-tab tab-write selected\"\n                    role=\"tab\" aria-selected=\"true\">\n              Write\n            </button>\n            <button type=\"button\" class=\"tabnav-tab tab-preview\"\n                    role=\"tab\">\n              Preview\n            </button>\n          </nav>\n        </header>\n        <div class=\"comment-body\">\n          <textarea class=\"form-control\" placeholder=\"Leave a comment\" aria-label=\"comment\"></textarea>\n          <div class=\"markdown-body\" style=\"display: none\">\n            ${nothingToPreview}\n          </div>\n        </div>\n        <footer class=\"comment-footer\">\n          <a class=\"text-link markdown-info\" tabindex=\"-1\" target=\"_blank\"\n             href=\"https://guides.github.com/features/mastering-markdown/\">\n            <svg class=\"octicon v-align-bottom\" viewBox=\"0 0 16 16\" version=\"1.1\"\n              width=\"16\" height=\"16\" aria-hidden=\"true\">\n              <path fill-rule=\"evenodd\" d=\"M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15\n                13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4\n                8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z\">\n              </path>\n            </svg>\n            Styling with Markdown is supported\n          </a>\n          <button class=\"btn btn-primary\" type=\"submit\">Comment</button>\n        </footer>\n      </form>`;\n\n    this.avatarAnchor = this.element.firstElementChild as HTMLAnchorElement;\n    this.avatar = this.avatarAnchor.firstElementChild as HTMLImageElement;\n    this.form = this.avatarAnchor.nextElementSibling as HTMLFormElement;\n    this.textarea = this.form!.firstElementChild!.nextElementSibling!.firstElementChild as HTMLTextAreaElement;\n    this.preview = this.form!.firstElementChild!.nextElementSibling!.lastElementChild as HTMLDivElement;\n    this.submitButton = this.form!.lastElementChild!.lastElementChild as HTMLButtonElement;\n\n    this.setUser(user);\n\n    this.textarea.addEventListener('input', this.handleInput);\n    this.form.addEventListener('submit', this.handleSubmit);\n    this.form.addEventListener('click', this.handleClick);\n    this.form.addEventListener('keydown', this.handleKeyDown);\n    handleTextAreaResize(this.textarea);\n  }\n\n  public setUser(user: User | null) {\n    this.user = user;\n    this.submitButton.textContent = user ? 'Comment' : 'Sign in to comment';\n    this.submitButton.disabled = !!user;\n\n    if (user) {\n      this.avatarAnchor.href = user.html_url;\n      this.avatar.alt = '@' + user.login;\n      this.avatar.src = user.avatar_url + '?v=3&s=88';\n    } else {\n      this.avatarAnchor.removeAttribute('href');\n      this.avatar.alt = '@anonymous';\n      this.avatar.src = anonymousAvatarUrl;\n      this.textarea.disabled = true;\n    }\n  }\n\n  public clear() {\n    this.textarea.value = '';\n  }\n\n  private handleInput = () => {\n    const text = this.textarea.value;\n    const isWhitespace = /^\\s*$/.test(text);\n    this.submitButton.disabled = isWhitespace;\n    if (this.textarea.scrollHeight < 450 && this.textarea.offsetHeight < this.textarea.scrollHeight) {\n      this.textarea.style.height = `${this.textarea.scrollHeight}px`;\n      scheduleMeasure();\n    }\n\n    clearTimeout(this.renderTimeout);\n    if (isWhitespace) {\n      this.preview.textContent = nothingToPreview;\n    } else {\n      this.preview.textContent = 'Loading preview...';\n      this.renderTimeout = setTimeout(\n        () => renderMarkdown(text).then(html => this.preview.innerHTML = html)\n          .then(() => processRenderedMarkdown(this.preview))\n          .then(scheduleMeasure),\n        500);\n    }\n  }\n\n  private handleSubmit = (event: Event) => {\n    event.preventDefault();\n    if (this.submitting) {\n      return;\n    }\n    this.submitting = true;\n    if (this.user) {\n      this.textarea.disabled = true;\n      this.submitButton.disabled = true;\n    }\n    this.submit(this.textarea.value).catch(() => 0).then(() => {\n      this.submitting = false;\n      this.textarea.disabled = !this.user;\n      this.textarea.value = '';\n      this.submitButton.disabled = false;\n      this.handleClick({ target: this.form.querySelector('.tabnav-tab.tab-write') } as any);\n      this.preview.textContent = nothingToPreview;\n    });\n  }\n\n  private handleClick = ({ target }: Event) => {\n    if (!(target instanceof HTMLButtonElement) || !target.classList.contains('tabnav-tab')) {\n      return;\n    }\n    if (target.classList.contains('selected')) {\n      return;\n    }\n    this.form.querySelector('.tabnav-tab.selected')!.classList.remove('selected');\n    target.classList.add('selected');\n    const isPreview = target.classList.contains('tab-preview');\n    this.textarea.style.display = isPreview ? 'none' : '';\n    this.preview.style.display = isPreview ? '' : 'none';\n    scheduleMeasure();\n  }\n\n  private handleKeyDown = ({ which, ctrlKey }: KeyboardEvent) => {\n    if (which === 13 && ctrlKey && !this.submitButton.disabled) {\n      this.form.dispatchEvent(new CustomEvent('submit'));\n    }\n  }\n}\n\nfunction handleTextAreaResize(textarea: HTMLTextAreaElement) {\n  const stopTracking = () => {\n    removeEventListener('mousemove', scheduleMeasure);\n    removeEventListener('mouseup', stopTracking);\n  };\n  const track = () => {\n    addEventListener('mousemove', scheduleMeasure);\n    addEventListener('mouseup', stopTracking);\n  };\n  textarea.addEventListener('mousedown', track);\n}\n","export function loadTheme(theme: string, origin: string) {\n  return new Promise(resolve => {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.setAttribute('crossorigin', 'anonymous');\n    link.onload = resolve;\n    link.href = `/stylesheets/themes/${theme}/utterances.css`;\n    document.head.appendChild(link);\n\n    addEventListener('message', event => {\n      if (event.origin === origin && event.data.type === 'set-theme') {\n        link.href = `/stylesheets/themes/${event.data.theme}/utterances.css`;\n      }\n    });\n  });\n}\n","import { pageAttributes as page } from './page-attributes';\nimport {\n  Issue,\n  IssueComment,\n  User,\n  setRepoContext,\n  loadIssueByTerm,\n  loadIssueByNumber,\n  loadCommentsPage,\n  loadUser,\n  postComment,\n  createIssue\n} from './github';\nimport { login } from './oauth';\nimport { TimelineComponent } from './timeline-component';\nimport { NewCommentComponent } from './new-comment-component';\nimport { startMeasuring, scheduleMeasure } from './measure';\nimport { loadTheme } from './theme';\n\nsetRepoContext(page);\n\nfunction loadIssue(): Promise<Issue | null> {\n  if (page.issueNumber !== null) {\n    return loadIssueByNumber(page.issueNumber);\n  }\n  return loadIssueByTerm(page.issueTerm as string);\n}\n\nPromise.all([loadIssue(), loadUser(), loadTheme(page.theme, page.origin)])\n  .then(([issue, user]) => bootstrap(issue, user));\n\nfunction bootstrap(issue: Issue | null, user: User | null) {\n  startMeasuring(page.origin);\n\n  const timeline = new TimelineComponent(user, issue);\n  document.body.appendChild(timeline.element);\n\n  if (issue && issue.comments > 0) {\n    loadCommentsPage(issue.number, 1)\n      .then(({ items }) => items.forEach(comment => timeline.appendComment(comment)));\n  }\n\n  if (issue && issue.locked) {\n    return;\n  }\n\n  const submit = (markdown: string) => {\n    if (user) {\n      let commentPromise: Promise<IssueComment>;\n      if (issue) {\n        commentPromise = postComment(issue.number, markdown);\n      } else {\n        commentPromise = createIssue(\n          page.issueTerm as string,\n          page.url,\n          page.title,\n          page.description\n        ).then(newIssue => {\n          issue = newIssue;\n          timeline.setIssue(issue);\n          return postComment(issue.number, markdown);\n        });\n      }\n      return commentPromise.then(comment => {\n        timeline.appendComment(comment);\n        newCommentComponent.clear();\n      });\n    }\n\n    return login().then(() => loadUser()).then(u => {\n      user = u;\n      timeline.setUser(user);\n      newCommentComponent.setUser(user);\n    });\n  };\n\n  const newCommentComponent = new NewCommentComponent(user, submit);\n  timeline.element.appendChild(newCommentComponent.element);\n  scheduleMeasure();\n}\n\naddEventListener('not-installed', function handleNotInstalled() {\n  removeEventListener('not-installed', handleNotInstalled);\n  document.querySelector('.timeline')!.insertAdjacentHTML('afterbegin', `\n  <div class=\"flash flash-error flash-not-installed\">\n    Error: utterances is not installed on <code>${page.owner}/${page.repo}</code>.\n    If you own this repo,\n    <a href=\"https://github.com/apps/utterances\" target=\"_blank\"><strong>install the app</strong></a>.\n    Read more about this change in\n    <a href=\"https://github.com/utterance/utterances/pull/25\" target=\"_blank\">the PR</a>.\n  </div>`);\n});\n"]}